<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TheShadyMoonCat — Link Card</title>

<!-- Pixel font (y2k vibe) -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- Font Awesome for social icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css">

<style>
  :root{
    --bg1: linear-gradient(135deg,#ff9ec9 0%, #ffd2f0 50%, #ffe7f6 100%);
    --glass: rgba(255,255,255,0.12);
    --glass-2: rgba(255,255,255,0.08);
    --accent: #ff5fb4;
    --radius: 18px;
    --card-pad: 18px;
    --max-width: 950px;
    --pixel-font: "Press Start 2P", system-ui, sans-serif;
  }

  html,body{
    height:100%;
    margin:0;
    font-family: "Pixelify Sans", Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    background: var(--bg1);
    background-attachment: fixed;
  }

  /* subtle pixel art tiled background using SVG data URI */
  body::before{
    content:"";
    position:fixed; inset:0; z-index:0;
    background-image:
      radial-gradient(circle at 10% 20%, rgba(255,255,255,0.02) 0 1px, transparent 1px),
      radial-gradient(circle at 70% 80%, rgba(0,0,0,0.02) 0 1px, transparent 1px);
    opacity:0.6;
    mix-blend-mode:overlay;
    pointer-events:none;
  }

  .wrap{
    max-width:var(--max-width);
    margin:32px auto;
    padding:24px;
    position:relative;
    z-index:2;
  }

  /* frosted main card */
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    border-radius:calc(var(--radius) + 6px);
    padding:28px;
    backdrop-filter: blur(8px) saturate(120%);
    -webkit-backdrop-filter: blur(8px) saturate(120%);
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow: 0 10px 30px rgba(0,0,0,0.14);
    display:grid;
    grid-template-columns: 1fr 320px;
    gap:20px;
  }

  /* mobile single column */
  @media (max-width:880px){
    .card{ 
      grid-template-columns: 1fr;
      display:flex;
      flex-direction:column;
    }
    
    .profile{
      order: -1; /* Move profile to top on mobile */
    }
    
    .content{
      order: 1;
    }
    
    .wrap{
      margin:16px auto;
      padding:12px;
    }
    
    .card{
      padding:16px;
      gap:16px;
    }
    
    .block{
      padding:12px;
    }
    
    h1{
      font-size:14px;
      margin-bottom:10px;
      word-wrap:break-word;
      overflow-wrap:break-word;
    }
    
    .now-playing-container{
      position:static;
      margin-bottom:16px;
      text-align:center;
    }
    
    #now-playing{
      font-size:8px;
      padding:6px 10px;
      display:block;
      max-width:100%;
      white-space:normal;
      word-wrap:break-word;
      overflow-wrap:break-word;
      line-height:1.4;
    }
    
    .avatar{
      width:100px;
      height:100px;
    }
    
    .name{
      font-size:11px;
    }
    
    .socials{
      gap:8px;
    }
    
    .socials a{
      width:36px;
      height:36px;
      font-size:16px;
    }
    
    .btn{
      font-size:9px;
      padding:6px 8px;
    }
    
    .k-item{
      padding:8px;
      gap:10px;
    }
    
    .k-item .thumb{
      width:48px;
      height:48px;
      flex:0 0 48px;
    }
    
    .k-meta .title{
      font-size:9px;
      line-height:1.3;
      word-wrap:break-word;
      overflow-wrap:break-word;
    }
    
    .k-meta .sub{
      font-size:9px;
      line-height:1.3;
      word-wrap:break-word;
      overflow-wrap:break-word;
    }
    
    .kpop-list{
      max-height:300px;
    }
    
    #links > div{
      flex-direction:column;
    }
    
    #links .btn{
      width:100%;
      text-align:center;
    }
    
    footer{
      font-size:9px;
      padding:0 8px;
    }
    
    small{
      font-size:10px;
    }
  }

  /* Left column: main content blocks */
  .content{
    display:flex;
    flex-direction:column;
    gap:16px;
  }

  .block{
    padding:var(--card-pad);
    border-radius:calc(var(--radius) - 6px);
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
    border: 1px dashed rgba(255,255,255,0.04);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
  }

  h1{
    font-family: var(--pixel-font);
    font-size:20px;
    margin: 0 0 8px 0;
    color:#111;
    letter-spacing:0.02em;
  }

  .subtitle{
    font-size:12px;
    opacity:0.85;
    margin-bottom:8px;
  }

  /* Now playing in top corner absolute */
  .now-playing-container{
    position:absolute;
    top:20px;
    right:20px;
    z-index:5;
  }

  #now-playing{
    display:inline-block;
    padding:8px 12px;
    border-radius:12px;
    font-family:var(--pixel-font);
    font-size:11px;
    text-decoration:none;
    color:#fff;
    background: linear-gradient(90deg, rgba(255,95,180,0.95), rgba(255,161,200,0.9));
    box-shadow: 0 6px 18px rgba(255,95,180,0.15);
  }

  /* Right column: mini profile + socials */
  .profile{
    display:flex;
    flex-direction:column;
    gap:12px;
    align-items:center;
    text-align:center;
  }

  .avatar{
    width:160px; height:160px;
    border-radius:24px;
    overflow:hidden;
    border: 1px solid rgba(255,255,255,0.06);
    box-shadow: 0 8px 30px rgba(255,95,180,0.08);
    filter: contrast(1.02);
  }

  .avatar img{
    width:100%;
    height:100%;
    object-fit:cover;
  }

  .name{
    font-family:var(--pixel-font);
    font-size:14px;
  }

  .bio{
    font-size:12px; opacity:0.9;
  }

  .socials{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    justify-content:center;
  }

  .socials a{
    display:inline-flex; align-items:center; justify-content:center;
    width:44px; height:44px; border-radius:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
    border:1px solid rgba(255,255,255,0.04);
    text-decoration:none;
    color:#111;
    font-size:20px;
  }

  .socials a:hover{
    background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
  }

  /* music controls */
  .audio-controls{
    display:flex; gap:10px; align-items:center; justify-content:flex-start;
  }
  .btn {
    font-family:var(--pixel-font); font-size:11px;
    padding:8px 12px; border-radius:10px; cursor:pointer;
    border: none; background:transparent; color:#111;
    box-shadow: inset 0 -2px 0 rgba(0,0,0,0.06);
    backdrop-filter: blur(6px);
  }

  .btn.primary{
    background: linear-gradient(90deg, rgba(255,95,180,0.95), rgba(255,161,200,0.9));
    color:white;
  }

  /* kpop list */
  .kpop-list{
    display:grid;
    gap:8px;
    max-height:320px;
    overflow:auto;
    padding-right:6px;
  }

  .k-item{
    display:flex; gap:12px; align-items:center; padding:10px;
    border-radius:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.02);
  }

  .k-item .thumb{
    width:56px; height:56px; border-radius:10px; overflow:hidden; flex:0 0 56px;
    background: repeating-linear-gradient(45deg, rgba(0,0,0,0.02) 0 2px, transparent 2px 4px);
  }
  .k-meta{ font-size:12px; }
  .k-meta .title{ font-family:var(--pixel-font); font-size:11px; }
  .k-meta .sub{ opacity:0.8; font-size:11px; }

  /* footer small notes */
  footer{ margin-top:14px; font-size:11px; opacity:0.75; text-align:center; }
</style>
</head>
<body>

<div class="wrap">

  <div class="now-playing-container">
    <!-- Container for the now playing widget -->
    <div class="now-playing-container-inner">
      <a href="" id="now-playing" data-username="Sos4kitty">Loading track info...</a>
    </div>
  </div>

  <div class="card">

    <div class="content">
      <div class="block">
        <h1>Welcome — TheShadyMoonCat</h1>

        <div class="block" id="links">
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <a href="https://www.tiktok.com/@theshadymooncat" class="btn">TikTok</a>
            <a href="https://www.instagram.com/theshadymooncat" class="btn">Instagram</a>
            <a href="https://bsky.app/profile/theshadymooncat.bsky.social" class="btn">Bluesky</a>
          </div>
        </div>

      </div>

      <div class="block">
        <h1>K-pop collection & biases</h1>

        <div id="kpop-grid" class="kpop-list"></div>

        <div style="margin-top:10px;">
          <button id="fetch-mb" class="btn">Load physical collection (takes a while)</button>
          <div id="mb-result" style="margin-top:8px;font-size:12px;"></div>
        </div>
      </div>

    </div>

    <aside class="profile block">
      <div class="avatar" id="avatar">
        <!-- Replace the URL below with your GitHub raw image URL -->
        <img src="https://github.com/theshadymooncat/TheShadyMoonCat/blob/main/avatar.jpg?raw=true" alt="TheShadyMoonCat">
      </div>
      <div class="name">TheShadyMoonCat</div>

      <div class="socials" id="socials">
        <!-- social icons inserted by JS -->
      </div>

      <div style="width:100%; margin-top:12px;">
        <small style="opacity:0.85;display:block;margin-bottom:6px;">Written (Crossposted except Twitter)</small>
        <div class="socials" id="socials-written">
          <!-- written platform icons inserted by JS -->
        </div>
      </div>

      <div style="width:100%; margin-top:8px;">
        <small style="opacity:0.85;display:block">Music</small>
        <div id="sc-links" style="display:flex;gap:6px;justify-content:center;margin-top:6px;">
          <a href="https://listenbrainz.org/user/Sos4kitty" class="btn">ListenBrainz</a>
          <a href="https://www.last.fm/user/Sos4kitty" class="btn">Last.fm</a>
        </div>
      </div>

    </aside>

  </div>

  <footer>
    Built for GitHub Pages — I don't think I need a GitHub link
  </footer>
</div>

<!-- audio element -->
<audio id="bgm" loop preload="auto">
  <source src="bgm.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>

<script>
/* ---------------------------
   Audio playback (background music auto-plays at 20%)
   --------------------------- */
const audio = document.getElementById('bgm');

// Attempt to autoplay at 20% (many browsers block autoplay until user gesture).
audio.volume = 0.2;
audio.play().catch(()=> {
  // Autoplay was blocked, music will remain paused until user interacts with page
  console.log('Autoplay blocked - user interaction needed');
});

/* ---------------------------
   Social icons + links
   --------------------------- */
const socialsData = [
  ["TikTok", "https://www.tiktok.com/@theshadymooncat", "fab fa-tiktok"],
  ["Instagram", "https://www.instagram.com/theshadymooncat", "fab fa-instagram"]
];

const socialsWritten = [
  ["Bluesky", "https://bsky.app/profile/theshadymooncat.bsky.social", "fab fa-bluesky"],
  ["Mastodon", "https://kpop.social/@TheShadyMoonCat", "fab fa-mastodon"],
  ["Threads", "https://www.threads.com/@theshadymooncat", "fab fa-threads"],
  ["Nostr", "https://nostr.band/npub107wl03jhtymu7snrug55nk2v333uekd34grn37x856zeh3up305s9g9snc", "fas fa-bolt"],
  ["Twitter", "https://x.com/TheShadyMoonCat", "fab fa-twitter"]
];

const socialsEl = document.getElementById('socials');
const socialsWrittenEl = document.getElementById('socials-written');

socialsData.forEach(s => {
  const a = document.createElement('a');
  a.href = s[1];
  a.target = "_blank";
  a.rel = "noopener noreferrer";
  a.title = s[0];
  a.innerHTML = `<i class="${s[2]}"></i>`;
  socialsEl.appendChild(a);
});

socialsWritten.forEach(s => {
  const a = document.createElement('a');
  a.href = s[1];
  a.target = "_blank";
  a.rel = "noopener noreferrer";
  a.title = s[0];
  a.innerHTML = `<i class="${s[2]}"></i>`;
  socialsWrittenEl.appendChild(a);
});

/* ---------------------------
   Now Playing widget (ListenBrainz)
   adapted from your provided code
   --------------------------- */
(function(){
  const username = "Sos4kitty";
  const displayElement = document.getElementById("now-playing");
  displayElement.href = `https://listenbrainz.org/user/${username}/`;
  displayElement.dataset.username = username;

  const endpoints = {
    nowPlaying: `https://api.listenbrainz.org/1/user/${username}/playing-now`,
    recentTrack: `https://api.listenbrainz.org/1/user/${username}/listens?count=1`,
  };

  async function fetchJson(url) {
    const response = await fetch(url);
    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
    return response.json();
  }

  function renderTrack(statusLabel, track) {
    const artist = track?.artist_name || "Unknown Artist";
    const title = track?.track_name || "Unknown Track";
    displayElement.textContent = `${statusLabel}: ${artist} — ${title}`;
  }

  async function updateNowPlayingWidget() {
    try {
      const nowPlayingData = await fetchJson(endpoints.nowPlaying);
      const playingNow = nowPlayingData?.payload?.playing_now;
      const currentTrack = nowPlayingData?.payload?.listens?.[0]?.track_metadata;

      if (playingNow && currentTrack) {
        renderTrack("Now Playing", currentTrack);
        return;
      }

      const recentData = await fetchJson(endpoints.recentTrack);
      const recentTrack = recentData?.payload?.listens?.[0]?.track_metadata;

      if (recentTrack) {
        renderTrack("Last Played", recentTrack);
      } else {
        displayElement.textContent = "This user has no listens yet";
      }
    } catch (error) {
      console.error("Failed to update Now Playing widget:", error);
      displayElement.textContent = "Error loading track info";
    }
  }

  updateNowPlayingWidget();
  setInterval(updateNowPlayingWidget, 60000);
})();

/* ---------------------------
   Kpop hardcoded list
   --------------------------- */
const kpopData = [
  // Ult
  {group: "Blackpink", bias: "Rosé", rank: "Ult"},
  {group: "itzy", bias: "Ryujin · Chaeryeong", rank: "ult"},
  {group: "Loona", bias: "HeeJin", rank: "Ult"},
  {group: "TripleS", bias: "Yoon Soyeon", rank: "Ult"},
  // Almost ult
  {group: "aespa", bias: "Winter", rank: "Almost ult"},
  {group: "Dreamcatcher", bias: "Dami", rank: "Almost ult"},
  {group: "billlie", bias: "Tsuki", rank: "Almost ult"},
  // Others
  {group: "NiziU", bias: "Ayaka", rank: ""},
  {group: "Nmixx", bias: "Kyujin", rank: ""},
  {group: "Stray kids", bias: "Hyunjin", rank: ""},
  {group: "kep1er", bias: "Bahiyyih, Xiaoting, Hikaru", rank: ""},
  {group: "stayc", bias: "J", rank: ""},
  {group: "(G)i-dle", bias: "Yuqi · Seoyeon", rank: ""},
  {group: "LE SSERAFIM", bias: "Chaewon · Sakura", rank: ""},
  {group: "Twice", bias: "Dahyun · Sana", rank: ""},
  {group: "Pixy", bias: "Dia, satbyeol, Dajeong Lola", rank: ""},
  {group: "Txt", bias: "Huening Kai", rank: ""},
  {group: "Got the beat", bias: "Winter · Seulgi", rank: ""},
  {group: "red velvet", bias: "Wendy · Seulgi", rank: ""},
  {group: "New Jeans", bias: "Haerin", rank: ""},
  {group: "Kiss of life", bias: "Belle", rank: ""},
  {group: "Babymonster", bias: "Raku", rank: "Bae (baby stan)"},
  {group: "WJSN COSMIC GIRLS", bias: "Yeorum · Bona, Exy", rank: ""},
  {group: "BabyMINT", bias: "Lin, Vikky", rank: ""},
  {group: "&team", bias: "Nicholas", rank: ""},
  {group: "Enhyphen", bias: "Jay", rank: ""},
  {group: "Izna", bias: "Jeong Saebi", rank: ""},
  {group: "idntt", bias: "DoHun, TaeIn, JaeYoung", rank: ""},
  // Soloists
  {group: "aleXa", bias: "—", rank: ""},
  {group: "Chung Ha", bias: "—", rank: ""}
];

const kpopGrid = document.getElementById('kpop-grid');

kpopData.forEach(item=>{
  const el = document.createElement('div');
  el.className = 'k-item';
  const thumb = document.createElement('div');
  thumb.className = 'thumb';
  thumb.innerHTML = '<img src="" alt="" style="width:100%;height:100%;object-fit:cover;" data-mbid="">';
  const meta = document.createElement('div');
  meta.className = 'k-meta';
  meta.innerHTML = `<div class="title">${item.group}</div><div class="sub">${item.bias}${item.rank ? ' · ' + item.rank : ''}</div>`;
  el.appendChild(thumb);
  el.appendChild(meta);
  kpopGrid.appendChild(el);
});

/* ---------------------------
   MusicBrainz collection loader
   Attempts to fetch the releases from your provided collection ID and display cover art
   --------------------------- */
const mbBtn = document.getElementById('fetch-mb');
const mbResult = document.getElementById('mb-result');

mbBtn.addEventListener('click', async ()=>{
  mbBtn.disabled = true;
  mbBtn.textContent = 'Loading...';
  mbResult.textContent = 'Fetching collection...';
  try {
    const collId = '5615c8b4-76c6-4c68-a9df-1937b86b6cfd';
    const url = `https://musicbrainz.org/ws/2/collection/${collId}/releases?fmt=json&limit=100`;
    const res = await fetch(url);
    if(!res.ok) throw new Error('MB fetch failed: ' + res.status);
    const json = await res.json();
    const releases = json.releases || [];
    if(!releases.length){
      mbResult.textContent = 'No releases found in collection.';
      mbBtn.disabled = false;
      mbBtn.textContent = 'Load physical collection (takes a while)';
      return;
    }

    // Show all releases with cover art
    const nodes = [];
    for (let i=0;i<releases.length;i++){
      const r = releases[i];
      const releaseId = r.id;
      // try to fetch cover art
      const caUrl = `https://coverartarchive.org/release/${releaseId}`;
      try {
        const ca = await fetch(caUrl);
        if (ca.ok){
          const caJson = await ca.json();
          const image = caJson.images?.[0]?.thumbnails?.['250'] || caJson.images?.[0]?.thumbnails?.small || caJson.images?.[0]?.image || null;
          nodes.push({title: r.title, image});
        } else {
          nodes.push({title: r.title, image: null});
        }
      } catch(e){
        nodes.push({title: r.title, image: null});
      }
    }

    // render
    mbResult.innerHTML = '';
    const wrap = document.createElement('div');
    wrap.style.display = 'grid';
    wrap.style.gridTemplateColumns = 'repeat(auto-fit,minmax(80px,1fr))';
    wrap.style.gap = '8px';
    nodes.forEach(n=>{
      const c = document.createElement('div');
      c.style.borderRadius='8px'; c.style.padding='6px'; c.style.textAlign='center';
      c.style.background='rgba(255,255,255,0.02)'; c.style.fontSize='11px';
      const img = document.createElement('img');
      img.style.width='100%'; img.style.height='80px'; img.style.objectFit='cover';
      img.style.borderRadius='6px';
      img.src = n.image || 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="80"><rect width="100%" height="100%" fill="%23ffd2f0"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="10" font-family="Arial" fill="%23ff5fb4">no art</text></svg>';
      const t = document.createElement('div'); t.textContent = n.title; t.style.marginTop='6px';
      c.appendChild(img); c.appendChild(t); wrap.appendChild(c);
    });
    mbResult.appendChild(wrap);

  } catch (err){
    console.error(err);
    mbResult.textContent = 'Error loading collection. See console for details.';
  } finally {
    mbBtn.disabled = false;
    mbBtn.textContent = 'Load physical collection (takes a while)';
  }
});

/* ---------------------------
   Last.fm artist images - OPTIONAL
   Uncomment and add your API key to enable artist images
   --------------------------- */
/*
const LASTFM_API_KEY = 'YOUR_API_KEY_HERE'; // Replace with your actual Last.fm API key

async function fetchArtistImages() {
  const items = document.querySelectorAll('.k-item');
  
  for (const item of items) {
    const title = item.querySelector('.title').textContent;
    const img = item.querySelector('img');
    
    try {
      const response = await fetch(
        `https://ws.audioscrobbler.com/2.0/?method=artist.getinfo&artist=${encodeURIComponent(title)}&api_key=${LASTFM_API_KEY}&format=json`
      );
      const data = await response.json();
      
      if (data.artist && data.artist.image) {
        const images = data.artist.image;
        const largeImg = images.find(i => i.size === 'large' || i.size === 'extralarge');
        if (largeImg && largeImg['#text']) {
          img.src = largeImg['#text'];
        }
      }
    } catch (error) {
      console.error(`Failed to fetch image for ${title}:`, error);
    }
    
    await new Promise(resolve => setTimeout(resolve, 200));
  }
}

// Uncomment to enable:
// fetchArtistImages();
*/

</script>
</body>
</html>
